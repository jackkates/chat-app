<!DOCTYPE html>
<head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
</head>
<body>
Messages

<div id="messages_div">
</div>


<input id="input">
<button id="submit">
    Send Messages!
</button>
<button id="anniversary">
    Anniversary Surprise!
</button>

<script>

    var anniversary_messages = ["Hi Nikita!", "It's our special day", "It's been a whole year since \
        we made the great decision to start dating", "I know that it is hard to be apart", "but I believe that we can do it",
        "and before you know it we'll be together again and we'll laugh and love like old times",
        "I really believe that I promise!", "I am imagining you looking really cute right now", 
        "and soon we can eat ramen and promote FocusBuddy together!", 
        "You are such a great part of my life and I hope you don't forget that",
        "and I hope you don't forget all the reasons I love you!",
        "Happy Anniversary", "Love, Jack"];

    async function getMessages() {
        var response = await fetch('/messages')
        var messages = await response.json()

        var div = document.getElementById("messages_div")
        div.removeChild(div.firstChild)
        var list = document.createElement('ul')
        div.appendChild(list)
        messages.forEach(message => {
            var list_item = document.createElement("li")
            var content = document.createTextNode(message)
            list_item.appendChild(content)
            list.appendChild(list_item)
        });
    }

    async function sendMessage(messageContent) {
        const options = {
            method: 'POST',
            headers: {
            "Content-Type": "application/json",
            },
            body: JSON.stringify({text: messageContent})
        }
        var response = await fetch("/send", options)
    }

    var socket = io.connect()
    socket.on("message", () => { 
        console.log("Socket message")
        getMessages() 
    })

    document.getElementById('submit').addEventListener("click", () => {
        console.log("Clicked")
        var text = document.getElementById("input").value
        socket.emit('message')
        sendMessage(text)
    })

    document.getElementById('anniversary').addEventListener('click', () => {
        for (var i = 0; i < anniversary_messages.length; i++) {
            let delay = i*200
            let message = anniversary_messages[i]
            console.log(message)
            setTimeout(() => {
                socket.emit('message')
                sendMessage(message)
            }, delay)
        }
    })

    getMessages()
    
</script>
</body>